---
sidebarDepth: 0
title: 数据库回导操作
---

## 说明
由于历史数据权限重构功能频繁的删除权限表，而权限表的数据量又比较大，会产生大量的无用的块数据，每隔半年或一年对数据进行导出再重新导入，重新分配存储和索引，有利于数据库的优化。

## 导出数据
<code>expdp name/password schemas=test1 directory=DUMP_MQH_FILE dumpfile=test1_20181003.dmp logfile=test1_20181003.log</code>

## 删除用户
<code>drop user test1 cascade;</code>
::: warning
提示140错误，直接重启数据库
:::

## 删除表空间及数据文件
```markdown
例：drop tablespace tbs_name including contents and datafiles;
DROP TABLESPACE BESTLINK INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKBASE INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKDETAIL INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKFEE INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKIDX INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKNEW INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKREQUEST INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKRIBAO INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BESTLINKRULE INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSION2012 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSION2013 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSION2014 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSION2015 INCLUDING CONTENTS AND DATAFILES;							
DROP TABLESPACE PERMISSIONS1 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS10 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS2 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS3 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS4 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS5 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS6 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS7 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS8 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONS9 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSIONSDOCBASE INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE PERMISSION_BAK INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE SYSTEMLOG INCLUDING CONTENTS AND DATAFILES;
```
## 查看asm磁盘组剩余空间大小
<code>select group_number,name,total_mb,free_mb from v$asm_diskgroup;</code>

## 创建表空间
```markdown
--bestlink表空间(64G)：
create tablespace BESTLINK datafile 
'+DG_DB/bestlink01' size 8000M reuse,
'+DG_DB/bestlink02' size 8000M reuse,
'+DG_DB/bestlink03' size 8000M reuse,
'+DG_DB/bestlink04' size 8000M reuse,
'+DG_DB/bestlink05' size 8000M reuse,
'+DG_DB/bestlink06' size 8000M reuse,
'+DG_DB/bestlink07' size 8000M reuse,
'+DG_DB/bestlink08' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--bestlinkbase表空间(8G)
create tablespace bestlinkbase datafile '+DG_DB/bestlinkbase01' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--BESTLINKDETAIL表空间(80G)
create tablespace BESTLINKDETAIL datafile 
'+DG_DB/bestlinkdetail01' size 8000M reuse,
'+DG_DB/bestlinkdetail02' size 8000M reuse,
'+DG_DB/bestlinkdetail03' size 8000M reuse,
'+DG_DB/bestlinkdetail04' size 8000M reuse,
'+DG_DB/bestlinkdetail05' size 8000M reuse,
'+DG_DB/bestlinkdetail06' size 8000M reuse,
'+DG_DB/bestlinkdetail07' size 8000M reuse,
'+DG_DB/bestlinkdetail08' size 8000M reuse,
'+DG_DB/bestlinkdetail09' size 8000M reuse,
'+DG_DB/bestlinkdetail10' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--BESTLINKFEE(8G)
create tablespace BESTLINKFEE datafile '+DG_DB/bestlinkfee01' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--BESTLINKIDX（24G）
create tablespace BESTLINKIDX datafile 
'+DG_INDEX/bestlinkidx01' size 8000M reuse,
'+DG_INDEX/bestlinkidx02' size 8000M reuse,
'+DG_INDEX/bestlinkidx03' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--BESTLINKNEW （8G）
create tablespace BESTLINKNEW datafile 
'+DG_DB/bestlinknew01' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--BESTLINKREQUEST(16G)
create tablespace BESTLINKREQUEST datafile 
'+DG_DB/bestlinkrequest01' size 8000M reuse,
'+DG_DB/bestlinkrequest02' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--BESTLINKRIBAO(16G)
create tablespace BESTLINKRIBAO datafile 
'+DG_DB/bestlinkribao01' size 8000M reuse,
'+DG_DB/bestlinkribao02' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--BESTLINKRULE(56)
create tablespace BESTLINKRULE datafile 
'+DG_DB/bestlinkrule01' size 8000M reuse,
'+DG_DB/bestlinkrule02' size 8000M reuse,
'+DG_DB/bestlinkrule03' size 8000M reuse,
'+DG_DB/bestlinkrule04' size 8000M reuse,
'+DG_DB/bestlinkrule05' size 8000M reuse,
'+DG_DB/bestlinkrule06' size 8000M reuse,
'+DG_DB/bestlinkrule07' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSION2012(4G)
create tablespace PERMISSION2012 datafile 
'+DG_DB/permission201201' size 4096M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSION2013(4G)
create tablespace PERMISSION2013 datafile 
'+DG_DB/permission201301' size 4096M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSION2014(6G)
create tablespace PERMISSION2014 datafile 
'+DG_DB/permission201401' size 6144M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSION2015(2G)
create tablespace PERMISSION2015 datafile 
'+DG_DB/permission201501' size 2048M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS1(8G)
create tablespace PERMISSIONS1 datafile 
'+DG_DB/permissions101' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS2(8G)
create tablespace PERMISSIONS2 datafile 
'+DG_DB/permissions201' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS3(16G)
create tablespace PERMISSIONS3 datafile 
'+DG_DB/permissions301' size 8000M reuse,
'+DG_DB/permissions302' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS4(16G)
create tablespace PERMISSIONS4 datafile 
'+DG_DB/permissions401' size 8000M reuse,
'+DG_DB/permissions402' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS5(16G)
create tablespace PERMISSIONS5 datafile 
'+DG_DB/permissions501' size 8000M reuse,
'+DG_DB/permissions502' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS6(8G)
create tablespace PERMISSIONS6 datafile 
'+DG_DB/permissions601' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS7(8G)
create tablespace PERMISSIONS7 datafile 
'+DG_DB/permissions701' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS8(8G)
create tablespace PERMISSIONS8 datafile 
'+DG_DB/permissions801' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS9(8G)
create tablespace PERMISSIONS9 datafile 
'+DG_DB/permissions901' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONS10(8G)
create tablespace PERMISSIONS10 datafile 
'+DG_DB/permissions1001' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSIONSDOCBASE(16G)
create tablespace PERMISSIONSDOCBASE datafile 
'+DG_DB/permissionsdoc01' size 8000M reuse,
'+DG_DB/permissionsdoc02' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--PERMISSION_BAK(28G)
create tablespace PERMISSION_BAK datafile 
'+DG_DB/permission_bak01' size 8000M reuse,
'+DG_DB/permission_bak02' size 8000M reuse,
'+DG_DB/permission_bak03' size 8000M reuse,
'+DG_DB/permission_bak04' size 8000M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
--SYSTEMLOG(2G)
create tablespace SYSTEMLOG datafile 
'+DG_DB/systemlog' size 2048M reuse LOGGING ONLINE PERMANENT EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M;
```
## 创建用户
<code>create user userName identified by password default tablespace bestlink;</code>

## 赋dba权限
<code>grant dba to userName;</code>

## 文件夹访问权限
<code>grant read ,write on directory dump_mqh_file to userName;</code>

## 数据导入
<code>impdp test1/Bestadmin123 directory=DUMP_MQH_FILE dumpfile=test1_20181003.dmp full=y</code>

## 操作记录
* 2018-10-03